<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>The Babelator</title>

<!-- Poppins -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700;800;900&display=swap" rel="stylesheet">

<style>
:root{
  --pink:#e6007a;
  --white:#ffffff;
  --grey:#5b5b5b;
  --shadow:0 14px 30px rgba(0,0,0,.08);
  --radius:999px;
  --stroke:2px;
  --w:520px;
  --rowH:68px;
  --rightW:210px;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  background:#fff;
  color:var(--pink);
}

.wrap{
  max-width:var(--w);
  margin:26px auto 44px;
  padding:0 14px;
}

.titleCapsule{
  border:var(--stroke) solid var(--pink);
  border-radius:var(--radius);
  padding:16px 18px;
  text-align:center;
  font-weight:900;
  font-size:34px;
  margin-bottom:18px;
  box-shadow:var(--shadow);
}

.stack{display:flex;flex-direction:column;gap:16px}

.pillRow{
  height:var(--rowH);
  background:var(--pink);
  border-radius:var(--radius);
  display:flex;
  align-items:center;
  padding:0 10px 0 22px;
  box-shadow:var(--shadow);
}

.pillLabel{
  font-weight:900;
  color:#fff;
  font-size:26px;
  white-space:nowrap;
}

.pillValue{
  margin-left:auto;
  height:calc(var(--rowH) - 12px);
  width:var(--rightW);
  background:#fff;
  border-radius:var(--radius);
  border:var(--stroke) solid var(--pink);
  display:flex;
  align-items:center;
  justify-content:flex-end;
  padding:0 16px;
  font-weight:900;
  font-size:26px;
  color:var(--grey);
}

.pillValue input{
  width:100%;
  border:none;
  outline:none;
  background:transparent;
  font:inherit;
  text-align:right;
}

/* MATRIX TOGGLE */
.matrixRow{display:flex;align-items:center;width:100%;gap:12px}
.matrixRow .pillLabel{flex:1}

.toggle{
  height:calc(var(--rowH) - 12px);
  width:210px;
  background:var(--pink);
  border:var(--stroke) solid var(--pink);
  border-radius:var(--radius);
  display:flex;
  align-items:center;
  padding:6px;
  position:relative;
}

.toggleBtn{
  flex:1;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:24px;
  font-weight:900;
  color:#fff;
  cursor:pointer;
  z-index:2;
}

.toggleKnob{
  position:absolute;
  top:6px;
  left:6px;
  width:calc(50% - 6px);
  height:calc(100% - 12px);
  background:#fff;
  border-radius:var(--radius);
  transition:.18s;
  z-index:1;
}

.toggle[data-value="B"] .toggleKnob{transform:translateX(100%)}
.toggle[data-value="A"] .btnA,
.toggle[data-value="B"] .btnB{color:var(--pink)}

/* ADVANCED */
details{
  border:2px dashed rgba(230,0,122,.25);
  border-radius:16px;
  padding:10px 12px;
}

summary{
  font-weight:800;
  cursor:pointer;
  list-style:none;
  display:flex;
  justify-content:space-between;
}
summary::-webkit-details-marker{display:none}

summary::after{
  content:"▾";
  transition:.2s;
}
details[open] summary::after{transform:rotate(180deg)}

.advGrid{
  margin-top:10px;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}

.advCard{
  border:2px solid rgba(230,0,122,.18);
  border-radius:14px;
  padding:10px;
  background:rgba(230,0,122,.03);
}

.advTitle{font-weight:900;font-size:14px;margin-bottom:6px}

table{
  width:100%;
  border-collapse:collapse;
  font-size:12px;
}

th,td{
  padding:7px 5px;
  border-bottom:1px solid rgba(230,0,122,.12);
}

th{font-weight:900;color:#a00057}

/* FIXED NUMBER INPUTS (Safari-safe) */
input.tier{
  width:100%;
  height:40px;
  padding:6px 12px;
  background:#fff;
  border-radius:18px;
  border:2px solid rgba(230,0,122,.20);
  font-family:"Poppins",system-ui;
  font-weight:700;
  font-size:14px;
  color:#5b5b5b;
  text-align:center;
  -webkit-appearance:none;
  appearance:none;
}

input.tier::-webkit-inner-spin-button,
input.tier::-webkit-outer-spin-button{
  -webkit-appearance:none;
  margin:0;
}

input.tier[type="number"]{
  -moz-appearance:textfield;
}

.btnRow{display:flex;gap:8px;margin-top:8px}
.smallBtn{
  border-radius:999px;
  border:2px solid rgba(230,0,122,.35);
  background:rgba(230,0,122,.08);
  font-weight:900;
  padding:8px 10px;
  cursor:pointer;
  font-size:12px;
}
.note{font-size:11px;margin-top:8px}
.error{display:none;color:#b0003b;font-weight:800;font-size:12px}
</style>
</head>

<body>
<div class="wrap">
<div class="titleCapsule">THE BABELATOR</div>

<div class="stack">

<div class="pillRow">
  <div class="matrixRow">
    <div class="pillLabel">MATRIX A OR B</div>
    <div class="toggle" id="matrixToggle" data-value="A">
      <div class="toggleKnob"></div>
      <div class="toggleBtn btnA" data-set="A">A</div>
      <div class="toggleBtn btnB" data-set="B">B</div>
    </div>
  </div>
</div>

<div class="pillRow">
  <div class="pillLabel">NUMBER OF ASSETS</div>
  <div class="pillValue"><input id="assetsInput" type="number" value="500"></div>
</div>

<div class="pillRow">
  <div class="pillLabel">TOTAL COST</div>
  <div class="pillValue" id="totalOut">£0</div>
</div>

<div class="pillRow">
  <div class="pillLabel">AVERAGE CPA</div>
  <div class="pillValue" id="cpaOut">£0</div>
</div>

<details>
<summary>Edit matrices</summary>

<div class="advGrid">
  <div class="advCard">
    <div class="advTitle">Matrix A</div>
    <table><thead><tr><th>Start</th><th>End</th><th>£/asset</th></tr></thead><tbody id="matrixA"></tbody></table>
    <div class="btnRow">
      <button class="smallBtn" data-reset="A">Reset A</button>
    </div>
  </div>

  <div class="advCard">
    <div class="advTitle">Matrix B</div>
    <table><thead><tr><th>Start</th><th>End</th><th>£/asset</th></tr></thead><tbody id="matrixB"></tbody></table>
    <div class="btnRow">
      <button class="smallBtn" data-reset="B">Reset B</button>
    </div>
  </div>
</div>

<div class="note">Pricing is applied “tax-style”.</div>
<div class="error" id="errBox">Fix matrix issues.</div>
</details>

</div>
</div>

<script>
const A=[
{start:1,end:25,rate:345},
{start:26,end:500,rate:40},
{start:501,end:1000,rate:30},
{start:1001,end:1500,rate:22.5},
{start:1501,end:null,rate:20}
];
const B=[
{start:1,end:25,rate:345},
{start:26,end:500,rate:45},
{start:501,end:1000,rate:35},
{start:1001,end:1500,rate:25},
{start:1501,end:null,rate:20}
];
let matrixA=structuredClone(A);
let matrixB=structuredClone(B);
let selected="A";

const $=id=>document.getElementById(id);

function money(n){return"£"+(Math.round(n*100)/100).toLocaleString()}
function calc(n,m){
 let t=0;
 m.forEach(r=>{
  const e=r.end??1e9;
  const c=Math.max(0,Math.min(n,e)-r.start+1);
  if(c>0)t+=c*r.rate;
 });
 return t;
}

function render(which){
 const t=$(which==="A"?"matrixA":"matrixB");
 const m=which==="A"?matrixA:matrixB;
 t.innerHTML="";
 m.forEach((r,i)=>{
  t.insertAdjacentHTML("beforeend",`
   <tr>
    <td><input class="tier" type="number" value="${r.start}"></td>
    <td><input class="tier" type="number" value="${r.end??""}"></td>
    <td><input class="tier" type="number" value="${r.rate}"></td>
   </tr>
  `);
 });
}

function recalc(){
 const n=+$("assetsInput").value||0;
 const m=selected==="A"?matrixA:matrixB;
 const total=calc(n,m);
 $("totalOut").textContent=money(total);
 $("cpaOut").textContent=money(n?total/n:0);
}

$("matrixToggle").onclick=e=>{
 const b=e.target.dataset.set;
 if(!b)return;
 selected=b;
 $("matrixToggle").dataset.value=b;
 recalc();
};

$("assetsInput").oninput=recalc;

render("A");render("B");recalc();
</script>
</body>
</html>
